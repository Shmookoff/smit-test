# Тестовое задание SMIT.Studio

## CargoTypes

При создании тарифа, `cargo_type` указывается названием. Мне показалось нелогичным не создавать модель CargoTypes, т.к. это +- константные данные, а при ошибке в одну букву (например `glass` вместо `Glass`) данные будут некорректными.  

При этом, в production системе, `cargo_type` скорее всего будет указываться его идентификатором, а не названием.  
При каждом создании тарифа искать `CargoType` по его названию кажется мне довольно большим overhead'ом (хотя это и можно оптимизировать до определенного момента).  
Поэтому решение с `CargoTypes.title` в качестве primary key показалось мне наиболее логичным. У этого есть и недостатки (например нельзя обновить `title` у определенной записи т.к. это primary key), но в данной информационной системе считаю это приемлемым.

## Аутентификация

По заданию, аутентификация не требовалась, но, думаю, не помешает даже самая простая. Для аутентификации я решил использовать простой Bearer токен админа, устанавливающийся переменной окружения `ADMIN_TOKEN`. При запросе к защищенным методам, токен должен передаваться в Authorization header (`Authorization='Bearer <ADMIN_TOKEN>'`).

## Обработка ошибок

Я также решил оставить стандартный обработчик ошибок из `tortoise.contrib.fastapi`, т.к. думаю, что обрабатывать каждую отдельную ошибку было бы выстрелом себе в ногу при ограниченном времени. Например, `IntegrityError` может означать многое, а корректно сообщать о каждом виде ошибок с контекстом в данной системе не есть приоритетом (с этим отлично справляется стандартный обработчик).

## Развертывание

1. Создать `.env` файл по примеру `.env.example`, заполнить `POSTGRES_PASSWORD` и `ADMIN_TOKEN`
2. Выполнить `docker compose up`
3. Сервис будет доступен по порту, указанном в переменной окружения `APP_PORT`

## Разработка

1. Установить poetry - https://python-poetry.org/docs/#installation
2. Установить зависимости `poetry install`
3. Запустить контейнер БД `docker-compose up -d postgres`
4. Запустить приложение `poetry run uvicorn smit_test.app:app --reload`